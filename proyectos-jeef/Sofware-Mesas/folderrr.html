<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reservas Restaurante</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">

  <div class="container my-4">
    <h1 class="text-center mb-4">Sistema de Reservas - Restaurante</h1>

    <!-- Sección de Mesas -->
    <div class="mb-4">
      <h3>Plano de Mesas</h3>
      <div id="mesasContainer" class="row g-3"></div>
      <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#modalMesa">Agregar Mesa</button>
    </div>

    <!-- Sección de Reservas -->
    <div class="mb-4">
      <h3>Reservas</h3>

      <div class="row mb-3">
        <div class="col-md-3">
          <input type="date" id="filtroFecha" class="form-control" placeholder="Filtrar por fecha">
        </div>
        <div class="col-md-3">
          <select id="filtroEstado" class="form-select">
            <option value="">Todos los estados</option>
            <option>Pendiente</option>
            <option>Confirmada</option>
            <option>Cancelada</option>
            <option>Finalizada</option>
            <option>No Show</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-secondary" id="btnFiltrar">Filtrar</button>
        </div>
      </div>

      <div id="reservasContainer" class="row g-3"></div>
      <button class="btn btn-success mt-3" data-bs-toggle="modal" data-bs-target="#modalReserva">Agregar Reserva</button>
    </div>
  </div>

  <!-- Modal Mesa -->
  <div class="modal fade" id="modalMesa" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Agregar / Editar Mesa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="formMesa">
            <input type="hidden" id="idMesa">
            <div class="mb-3">
              <label>Capacidad</label>
              <input type="number" id="capacidadMesa" class="form-control" min="1" required>
            </div>
            <div class="mb-3">
              <label>Ubicación</label>
              <input type="text" id="ubicacionMesa" class="form-control" required>
            </div>
            <div class="mb-3">
              <label>Estado</label>
              <select id="estadoMesa" class="form-select">
                <option value="disponible">Disponible</option>
                <option value="ocupada">Ocupada</option>
                <option value="deshabilitada">Deshabilitada</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Guardar Mesa</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Reserva -->
  <div class="modal fade" id="modalReserva" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Agregar / Editar Reserva</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="formReserva">
            <input type="hidden" id="idReserva">
            <div class="mb-3">
              <label>Nombre del Cliente</label>
              <input type="text" id="nombreCliente" class="form-control" required>
            </div>
            <div class="mb-3">
              <label>Número de Personas</label>
              <input type="number" id="numPersonas" class="form-control" min="1" required>
            </div>
            <div class="mb-3">
              <label>Fecha</label>
              <input type="date" id="fechaReserva" class="form-control" required>
            </div>
            <div class="mb-3">
              <label>Hora</label>
              <input type="time" id="horaReserva" class="form-control" min="08:00" max="20:00" required>
            </div>
            <div class="mb-3">
              <label>Ocasión Especial</label>
              <select id="ocasionReserva" class="form-select" required>
                <option value="Cumpleaños">Cumpleaños</option>
                <option value="Aniversario">Aniversario</option>
                <option value="Reunión de Negocios">Reunión de Negocios</option>
                <option value="Cena Romántica">Cena Romántica</option>
                <option value="Fiesta">Fiesta</option>
                <option value="Graduación">Graduación</option>
                <option value="Reunión Familiar">Reunión Familiar</option>
                <option value="Ninguna">Ninguna</option>
              </select>
            </div>
            <div class="mb-3">
              <label>Notas Adicionales</label>
              <textarea id="notasReserva" class="form-control"></textarea>
            </div>
            <div class="mb-3">
              <label>Mesa</label>
              <select id="mesaReserva" class="form-select" required></select>
            </div>
            <button type="submit" class="btn btn-primary">Guardar Reserva</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
</body>
<script>

// Inicializar datos en localStorage
let mesas = JSON.parse(localStorage.getItem("mesas")) || [];
let reservas = JSON.parse(localStorage.getItem("reservas")) || [];

// Generar ID único
const generarID = () => '_' + Math.random().toString(36).substr(2, 9);

// Renderizar mesas
function renderMesas() {
  const container = document.getElementById("mesasContainer");
  container.innerHTML = "";
  mesas.forEach(mesa => {
    const div = document.createElement("div");
    div.className = "col-md-3";
    div.innerHTML = `
      <div class="card p-2 mesa-${mesa.estado}">
        <h5>${mesa.id}</h5>
        <p>Capacidad: ${mesa.capacidad}</p>
        <p>Ubicación: ${mesa.ubicacion}</p>
        <p>Estado: ${mesa.estado}</p>
        <button class="btn btn-warning btn-sm" onclick="editarMesa('${mesa.id}')">Editar</button>
        <button class="btn btn-success btn-sm" onclick="reservarMesa('${mesa.id}')">Reservar</button>
        <button class="btn btn-danger btn-sm" onclick="eliminarMesa('${mesa.id}')">Eliminar</button>
      </div>
    `;
    container.appendChild(div);
  });
}

// Renderizar reservas
function renderReservas(filtroFecha = "", filtroEstado = "") {
  const container = document.getElementById("reservasContainer");
  container.innerHTML = "";
  let lista = reservas.filter(r => 
    (!filtroFecha || r.fechaReserva === filtroFecha) &&
    (!filtroEstado || r.estado === filtroEstado)
  );

  lista.forEach(res => {
    const div = document.createElement("div");
    div.className = "col-md-4";
    div.innerHTML = `
      <div class="card card-reserva p-2">
        <img src="img/${res.ocasionEspecial}.jpg" alt="Imagen">
        <h5>${res.nombreCliente}</h5>
        <p>Personas: ${res.numeroPersonas}</p>
        <p>Mesa: ${res.idMesaAsignada}</p>
        <p>Fecha/Hora: ${res.fechaReserva} ${res.horaReserva}</p>
        <p>Ocasión: ${res.ocasionEspecial}</p>
        <p>Estado: ${res.estado}</p>
        <button class="btn btn-warning btn-sm" onclick="editarReserva('${res.idReserva}')">Editar</button>
        <button class="btn btn-success btn-sm" onclick="pagarReserva('${res.idReserva}')">Pagar</button>
        <button class="btn btn-danger btn-sm" onclick="eliminarReserva('${res.idReserva}')">Eliminar</button>
      </div>
    `;
    container.appendChild(div);
  });
}

// Guardar mesas y reservas en localStorage
function guardarLocalStorage() {
  localStorage.setItem("mesas", JSON.stringify(mesas));
  localStorage.setItem("reservas", JSON.stringify(reservas));
}

// Manejo de formulario de mesa
document.getElementById("formMesa").addEventListener("submit", function(e) {
  e.preventDefault();
  const id = document.getElementById("idMesa").value || generarID();
  const capacidad = parseInt(document.getElementById("capacidadMesa").value);
  const ubicacion = document.getElementById("ubicacionMesa").value;
  const estado = document.getElementById("estadoMesa").value;

  const index = mesas.findIndex(m => m.id === id);
  const mesaObj = {id, capacidad, ubicacion, estado};

  if(index >= 0) mesas[index] = mesaObj;
  else mesas.push(mesaObj);

  guardarLocalStorage();
  renderMesas();
  document.getElementById("formMesa").reset();
  bootstrap.Modal.getInstance(document.getElementById('modalMesa')).hide();
});

// Manejo de formulario de reserva
document.getElementById("formReserva").addEventListener("submit", function(e) {
  e.preventDefault();
  const idReserva = document.getElementById("idReserva").value || generarID();
  const nombreCliente = document.getElementById("nombreCliente").value;
  const numeroPersonas = parseInt(document.getElementById("numPersonas").value);
  const fechaReserva = document.getElementById("fechaReserva").value;
  const horaReserva = document.getElementById("horaReserva").value;
  const ocasionEspecial = document.getElementById("ocasionReserva").value;
  const notasAdicionales = document.getElementById("notasReserva").value;
  const idMesaAsignada = document.getElementById("mesaReserva").value;

  // Validaciones básicas
  if(!nombreCliente || numeroPersonas <= 0 || !fechaReserva || !horaReserva) {
    alert("Complete todos los campos correctamente");
    return;
  }

  const index = reservas.findIndex(r => r.idReserva === idReserva);
  const reservaObj = {
    idReserva, nombreCliente, numeroPersonas, fechaReserva, horaReserva,
    ocasionEspecial, notasAdicionales, idMesaAsignada, estado: "Pendiente"
  };

  if(index >= 0) reservas[index] = reservaObj;
  else reservas.push(reservaObj);

  // Cambiar estado de mesa a ocupada
  const mesaIndex = mesas.findIndex(m => m.id === idMesaAsignada);
  if(mesaIndex >= 0) mesas[mesaIndex].estado = "ocupada";

  guardarLocalStorage();
  renderMesas();
  renderReservas();
  document.getElementById("formReserva").reset();
  bootstrap.Modal.getInstance(document.getElementById('modalReserva')).hide();
});

// Funciones de acciones
function editarMesa(id) {
  const mesa = mesas.find(m => m.id === id);
  if(!mesa) return;
  document.getElementById("idMesa").value = mesa.id;
  document.getElementById("capacidadMesa").value = mesa.capacidad;
  document.getElementById("ubicacionMesa").value = mesa.ubicacion;
  document.getElementById("estadoMesa").value = mesa.estado;
  new bootstrap.Modal(document.getElementById('modalMesa')).show();
}

function eliminarMesa(id) {
  if(!confirm("Desea eliminar la mesa?")) return;
  mesas = mesas.filter(m => m.id !== id);
  guardarLocalStorage();
  renderMesas();
}

function reservarMesa(id) {
  const select = document.getElementById("mesaReserva");
  select.value = id;
  new bootstrap.Modal(document.getElementById('modalReserva')).show();
}

// Rellenar dropdown mesas disponibles
function llenarMesasDisponibles() {
  const select = document.getElementById("mesaReserva");
  select.innerHTML = "";
  mesas.filter(m => m.estado === "disponible").forEach(m => {
    const option = document.createElement("option");
    option.value = m.id;
    option.textContent = `${m.id} - ${m.capacidad} personas`;
    select.appendChild(option);
  });
}

// Acciones de reserva
function editarReserva(idReserva) {
  const res = reservas.find(r => r.idReserva === idReserva);
  if(!res) return;

  document.getElementById("idReserva").value = res.idReserva;
  document.getElementById("nombreCliente").value = res.nombreCliente;
  document.getElementById("numPersonas").value = res.numeroPersonas;
  document.getElementById("fechaReserva").value = res.fechaReserva;
  document.getElementById("horaReserva").value = res.horaReserva;
  document.getElementById("ocasionReserva").value = res.ocasionEspecial;
  document.getElementById("notasReserva").value = res.notasAdicionales;
  llenarMesasDisponibles();
  document.getElementById("mesaReserva").value = res.idMesaAsignada;
  new bootstrap.Modal(document.getElementById('modalReserva')).show();
}

function pagarReserva(idReserva) {
  const res = reservas.find(r => r.idReserva === idReserva);
  if(!res) return;
  res.estado = "Finalizada";
  const mesa = mesas.find(m => m.id === res.idMesaAsignada);
  if(mesa) mesa.estado = "disponible";
  guardarLocalStorage();
  renderMesas();
  renderReservas();
}

function eliminarReserva(idReserva) {
  if(!confirm("Desea eliminar la reserva?")) return;
  reservas = reservas.filter(r => r.idReserva !== idReserva);
  guardarLocalStorage();
  renderReservas();
}

// Filtro
document.getElementById("btnFiltrar").addEventListener("click", () => {
  const fecha = document.getElementById("filtroFecha").value;
  const estado = document.getElementById("filtroEstado").value;
  renderReservas(fecha, estado);
});

// Inicialización
llenarMesasDisponibles();
renderMesas();
renderReservas();

</script>

</html>